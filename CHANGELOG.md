# Changelog

## [0.5.1] — 2026-02-28

### Frontend

#### Изменено — Полная унификация цветовой палитры

- Все страницы (`auth.html`, `profile.html`, `recording.html`, `contacts and about.html`, `status.html`, `main.html`) и `styles.css` приведены к единой палитре v0.5.0
- **Hero-баннеры**: градиент `#16a34a → #15803d` (всё зелёное) → `#16a34a → #0891b2` (зелёный+teal) на всех страницах
- **Баннер профиля**: тройной зелёный градиент → `#16a34a → #0284c7 → #0891b2`
- **Цвет заголовков** `#064e3b` (тёмно-зелёный) → `#0c4a6e` (тёмный teal-blue) везде
- **Цвет подзаголовков** `#065f46` → `#0369a1` везде
- **Тени секций** `rgba(21,128,61,…)` → `rgba(15,23,42,…)` (нейтральные slate-тени)
- **Границы карточек** `rgba(22,163,74,0.14)` → `rgba(8,145,178,0.12)` (sky-border)
- `auth.html` — тело страницы (фон): `зелёный→тёмно-зелёный` → `зелёный→sky-teal`

---

## [0.5.0] — 2026-02-28

### Frontend

#### Изменено — Цветовая палитра (Design refresh)

**Светлая тема:**
- `--bg`: `#f0fdf4` → `#f8fafc` (нейтральный slate-50 — чище, не перегружен зелёным)
- `--accent-2`: `#10b981` → `#0891b2` (sky-600 — медицинский синий-teal как вторичный акцент)
- Добавлены переменные `--blue: #0ea5e9` и `--blue-dark: #0284c7`
- `--muted`: `#6b7280` → `#64748b`; `--border-soft` стал менее насыщенным зелёным
- Фон body: добавлены синие радиальные градиенты, убраны тяжёлые зелёные
- Полоска-акцент header: `зелёный → синий` стало двуцветным (`#0891b2 → #16a34a → #0ea5e9 → #34d399`)
- Заголовок hero h1: градиент `#064e3b→#16a34a→#10b981` → `#0891b2→#16a34a→#059669`
- Кнопка `.btn-primary`: градиент `зелёный→тёмно-зелёный` → `зелёный→синий (#16a34a→#0891b2)`; hover — `#15803d→#0284c7`
- Тег `.tag`: был зелёным → стал синим (`rgba(8,145,178,…) #0369a1`)
- Бейдж `.badge` (очередь): `#86efac→#10b981` зелёный → `#22d3ee→#0891b2` голубой
- Активная ссылка навигации: `зелёный→тёмно-зелёный` → `зелёный→синий`

**Тёмная тема (полный ребрендинг):**
- `--bg`: `#0d1f14` (тёмно-зелёный) → `#090d0f` (почти чёрный, нейтральный)
- `--card`: `#132910` → `#111827` (gray-900)
- `--accent-2`: `#34d399` → `#38bdf8` (sky-400, синий)
- Добавлены `--blue: #38bdf8`, `--blue-dark: #0ea5e9`  
- `--text`: `#f0fdf4` → `#f1f5f9`; `--text-soft`: `#bbf7d0` → `#cbd5e1`; `--muted`: `#6ee7b7` → `#64748b`
- `--border-soft` и все `rgba(34,197,94,…)` в HTML-файлах → `rgba(56,189,248,…)`
- Все хардкодные тёмно-зелёные цвета в HTML (`#132910`, `#0a1f10`, `#1a3a28`, `#0f2d1e`) заменены на нейтральные тёмные (`#111827`, `#0d1117`, `#131f2e`)
- `input:focus` в тёмной теме: обводка теперь sky-синяя (`--accent-2`)
- Градиент body в тёмной теме: зелёные глоу → синие+зелёные
- Header в тёмной теме: `rgba(13,31,20,0.95)` → `rgba(9,13,15,0.97)` + border sky-синяя

#### Добавлено — Кастомный пикер даты и времени
- Поле `datetime-local` (стандартный браузерный) заменено на кастомный двухпанельный пикер:
  - **Календарь** — навигация по месяцам (‹ / ›), заблокированы прошедшие даты и воскресенья, подсветка сегодня
  - **Слоты времени** — кнопки с шагом 30 мин; пн–пт 08:00–18:00, суббота 09:00–14:00
  - Итоговая строка "✅ Пятница, 6 марта 2026 в 10:00" под пикером
  - Полная поддержка тёмной темы

#### Изменено — Навигация
- Ссылка "О проекте & Контакты" полностью убрана из навигационной панели на всех страницах
- На главной странице вместо неё — кнопка "О проекте & Контакты" в hero-секции рядом с остальными CTA

---

## [0.4.1] — 2026-02-28

### Backend

#### Удалено
- **`add_hospitals.py`** — старый тестовый скрипт с поддельными адресами; полностью заменён `add_real_hospitals.py` ещё в v0.1.0, теперь убран
- **`venv/`** — старое дублирующее виртуальное окружение (активное — `.venv/`)
- **`AppointmentSerializer`** — неиспользуемый сериализатор удалён из `serializers.py`

#### Исправлено
- **Утечка данных** — `AppointmentViewSet` был унаследован от `ModelViewSet`, из-за чего `GET /api/appointments/` отдавал записи **всех пациентов** без авторизации. Переведён на `mixins.CreateModelMixin + GenericViewSet`: публично доступны только создание записи, проверка статуса по коду и отмена
- **`seed_doctors.py`** — убрана лишняя переменная `cabinet = f'{cab}'` (избыточный f-string); теперь `cab` передаётся напрямую

#### Изменено
- `appointments/tests.py` — удалён неиспользуемый импорт `TestCase`

---

## [0.4.0] — 2026-02-28

### Frontend

#### Добавлено
- **Интерактивная карта больниц** на главной странице — Leaflet.js 1.9.4 + OpenStreetMap; маркеры с попапами (название, тип, адрес, очередь, кнопка «Записаться»)
- Каждая больница отображается по **реальным GPS-координатам**, привязанным к имени учреждения (`HOSPITAL_COORDS`)
- Прокрутка колёсиком мыши для зума карты

#### Изменено
- Блок «Быстрая запись» в hero-секции заменён картой
- `script.js` — после `loadHospitals()` данные экспортируются в `window.hospitals` и диспатчится событие `hospitalsReady`; карта инициализируется по событию вместо polling-таймера

#### Исправлено
- Карта не загружалась из-за того, что `let hospitals` не становится свойством `window` — исправлено явным присвоением `window.hospitals`
- **13 неверных адресов** исправлены по данным 2ГИС: ГП №1–7, №12, ГКБ №1, №4, №7, ЦГКБ, ДП №4

---

## [0.3.0] — 2026-02-27

### Backend

#### Добавлено
- **Модель `Doctor`** — врач привязан к больнице, хранит ФИО, специальность, кабинет, рабочие дни/часы, статус (`is_active`)
- **12 специальностей** вместо 4: Терапевт, Хирург, Стоматолог, Педиатр, Кардиолог, Невролог, Офтальмолог, Дерматолог, Эндокринолог, Гинеколог, Уролог, Психиатр
- **Поле `doctor`** в модели `Appointment` — nullable FK на Doctor
- **`GET /api/hospitals/{id}/doctors/`** — список активных врачей больницы, сгруппированный по специальности; каждый врач содержит текущий размер очереди
- **`DoctorAdmin`** в Django Admin
- **Management command `seed_doctors`** — заполняет таблицу Doctor реалистичными данными (341 врач по 31 больнице); безопасен для повторного запуска

#### Изменено
- `AppointmentCreateSerializer` — принимает необязательное поле `doctor`; при передаче специальность синхронизируется из врача
- `AppointmentStatusSerializer` — добавлены поля `doctor_name` и `doctor_cabinet`

### Frontend

#### Добавлено
- **Динамическая сетка специальностей** — при выборе больницы `recording.html` запрашивает `/api/hospitals/{id}/doctors/` и перестраивает сетку (с числом врачей по каждой специальности)
- **Панель выбора врача** — после клика на специальность показываются карточки врачей с ФИО, кабинетом, часами работы и текущей очередью; выбор необязателен
- Подтверждение записи теперь показывает имя врача и кабинет (если врач выбран)

#### Изменено
- `script.js` — передаёт `doctor: id` в тело запроса при бронировании; добавлена переменная `doctorId`

---

## [0.2.0] — 2026-02-27

### Backend

#### Добавлено
- **JWT-аутентификация** (`djangorestframework-simplejwt==5.3.1`)
  - `POST /api/auth/login/` теперь возвращает `access` и `refresh` токены
  - `POST /api/auth/verify/` (подтверждение email) тоже возвращает токены — пользователь сразу авторизован после регистрации
  - `POST /api/auth/token/refresh/` — обновление access-токена по refresh
- **Модель `VerificationCode`** — коды подтверждения email теперь хранятся в БД вместо памяти процесса (`verification_codes = {}`)
  - Поля: `email`, `code`, `name`, `password`, `created_at`
  - Метод `is_expired()` — код истекает через 10 минут
- **Поле `user`** в модели `Appointment` — запись теперь привязывается к авторизованному пользователю (nullable FK)
- **`GET /api/appointments/my_appointments/`** — возвращает записи текущего авторизованного пользователя (требует JWT-токен)
- **`.env.example`** — шаблон переменных окружения (`SECRET_KEY`, email, reCAPTCHA)
- **`VerificationCode`** добавлен в Django Admin

#### Изменено
- `POST /api/appointments/cancel/` — после отмены записи автоматически пересчитываются `queue_position` у всех оставшихся в очереди на тот же день
- `SECRET_KEY` вынесен в `.env` (больше не хардкодится в `settings.py`)
- `REST_FRAMEWORK` в `settings.py` — добавлена `DEFAULT_AUTHENTICATION_CLASSES` с JWT
- `resend_code` — при повторной отправке старый код удаляется из БД, создаётся новый

#### Исправлено
- Коды верификации больше не теряются при перезапуске сервера
- `my_appointments` раньше  подвозвращал всетверждённые записи всех пользователей — теперь только текущего

### Git / Инфраструктура

#### Добавлено
- `djangorestframework-simplejwt==5.3.1` в `requirements.txt`
- `.env` добавлен в `.gitignore` — секреты больше не попадают в репозиторий
- `db.sqlite3` добавлен в `.gitignore`
- `__pycache__/` и `*.pyc` убраны из git-отслеживания

#### Удалено
- Все `__pycache__/` и `.pyc` файлы из репозитория
- `db.sqlite3` из репозитория
- `__MACOSX/` из репозитория

---

## [0.1.0] — 2026-02-27

### Первоначальная версия

#### Backend
- Модели `Hospital` и `Appointment`
- API: список больниц, создание записи, проверка статуса по коду, отмена записи
- Регистрация с подтверждением email (Yandex SMTP)
- Вход по email/password
- Google reCAPTCHA при регистрации и входе
- Django Admin для больниц и записей

#### Frontend
- Страницы: `main.html`, `recording.html`, `status.html`, `profile.html`, `auth.html`, `contacts and about.html`
- Тёмная/светлая тема
- Мобильное меню
- Навигация с активным состоянием на каждой странице
