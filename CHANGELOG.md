# Changelog

## [0.3.0] — 2026-02-27

### Backend

#### Добавлено
- **Модель `Doctor`** — врач привязан к больнице, хранит ФИО, специальность, кабинет, рабочие дни/часы, статус (`is_active`)
- **12 специальностей** вместо 4: Терапевт, Хирург, Стоматолог, Педиатр, Кардиолог, Невролог, Офтальмолог, Дерматолог, Эндокринолог, Гинеколог, Уролог, Психиатр
- **Поле `doctor`** в модели `Appointment` — nullable FK на Doctor
- **`GET /api/hospitals/{id}/doctors/`** — список активных врачей больницы, сгруппированный по специальности; каждый врач содержит текущий размер очереди
- **`DoctorAdmin`** в Django Admin
- **Management command `seed_doctors`** — заполняет таблицу Doctor реалистичными данными (341 врач по 31 больнице); безопасен для повторного запуска

#### Изменено
- `AppointmentCreateSerializer` — принимает необязательное поле `doctor`; при передаче специальность синхронизируется из врача
- `AppointmentStatusSerializer` — добавлены поля `doctor_name` и `doctor_cabinet`

### Frontend

#### Добавлено
- **Динамическая сетка специальностей** — при выборе больницы `recording.html` запрашивает `/api/hospitals/{id}/doctors/` и перестраивает сетку (с числом врачей по каждой специальности)
- **Панель выбора врача** — после клика на специальность показываются карточки врачей с ФИО, кабинетом, часами работы и текущей очередью; выбор необязателен
- Подтверждение записи теперь показывает имя врача и кабинет (если врач выбран)

#### Изменено
- `script.js` — передаёт `doctor: id` в тело запроса при бронировании; добавлена переменная `doctorId`

---

## [0.2.0] — 2026-02-27

### Backend

#### Добавлено
- **JWT-аутентификация** (`djangorestframework-simplejwt==5.3.1`)
  - `POST /api/auth/login/` теперь возвращает `access` и `refresh` токены
  - `POST /api/auth/verify/` (подтверждение email) тоже возвращает токены — пользователь сразу авторизован после регистрации
  - `POST /api/auth/token/refresh/` — обновление access-токена по refresh
- **Модель `VerificationCode`** — коды подтверждения email теперь хранятся в БД вместо памяти процесса (`verification_codes = {}`)
  - Поля: `email`, `code`, `name`, `password`, `created_at`
  - Метод `is_expired()` — код истекает через 10 минут
- **Поле `user`** в модели `Appointment` — запись теперь привязывается к авторизованному пользователю (nullable FK)
- **`GET /api/appointments/my_appointments/`** — возвращает записи текущего авторизованного пользователя (требует JWT-токен)
- **`.env.example`** — шаблон переменных окружения (`SECRET_KEY`, email, reCAPTCHA)
- **`VerificationCode`** добавлен в Django Admin

#### Изменено
- `POST /api/appointments/cancel/` — после отмены записи автоматически пересчитываются `queue_position` у всех оставшихся в очереди на тот же день
- `SECRET_KEY` вынесен в `.env` (больше не хардкодится в `settings.py`)
- `REST_FRAMEWORK` в `settings.py` — добавлена `DEFAULT_AUTHENTICATION_CLASSES` с JWT
- `resend_code` — при повторной отправке старый код удаляется из БД, создаётся новый

#### Исправлено
- Коды верификации больше не теряются при перезапуске сервера
- `my_appointments` раньше  подвозвращал всетверждённые записи всех пользователей — теперь только текущего

### Git / Инфраструктура

#### Добавлено
- `djangorestframework-simplejwt==5.3.1` в `requirements.txt`
- `.env` добавлен в `.gitignore` — секреты больше не попадают в репозиторий
- `db.sqlite3` добавлен в `.gitignore`
- `__pycache__/` и `*.pyc` убраны из git-отслеживания

#### Удалено
- Все `__pycache__/` и `.pyc` файлы из репозитория
- `db.sqlite3` из репозитория
- `__MACOSX/` из репозитория

---

## [0.1.0] — 2026-02-27

### Первоначальная версия

#### Backend
- Модели `Hospital` и `Appointment`
- API: список больниц, создание записи, проверка статуса по коду, отмена записи
- Регистрация с подтверждением email (Yandex SMTP)
- Вход по email/password
- Google reCAPTCHA при регистрации и входе
- Django Admin для больниц и записей

#### Frontend
- Страницы: `main.html`, `recording.html`, `status.html`, `profile.html`, `auth.html`, `contacts and about.html`
- Тёмная/светлая тема
- Мобильное меню
- Навигация с активным состоянием на каждой странице
